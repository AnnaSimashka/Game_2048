(()=>{"use strict";var e={d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Z:()=>h});const t=["#afa192","#eee4da","#ede0c8","#f2b179","#ffcea4","#e8c064","#ffab6e","#fd9982","#ead79c","#76daff","#beeaa5","#d7d4f0"];class s{constructor(e,t){this.value="",this.dom=null}getValue(){return this.value}setValue(e){this.value=e,this.dom.textContent=e,this.dom.style.backgroundColor=t[Math.trunc(Math.sqrt(e))]}getNewElement(){if(null!==this.dom)throw new Error("Cell уже существует!");const e=document.createElement("div");return e.innerHTML="",e.className="cell",this.dom=e,e}}const r=document.querySelector(".score");class o{constructor(e,t,s,r){this.widthBoard=4,this.squares=[],this.wrapper=document.querySelector(".grid"),this.gameManager=new h}init(){const e=document.createDocumentFragment();for(let t=0;t<this.widthBoard*this.widthBoard;t++){const t=new s;e.appendChild(t.getNewElement()),this.squares.push(t)}this.wrapper.appendChild(e)}generateNewCell(){const e=Math.floor(Math.random()*this.squares.length);""===this.squares[e].getValue()?this.squares[e].setValue(2):this.generateNewCell()}movingColumn(e){for(let t=0;t<this.widthBoard;t++)this.fillColumn(t,"up"===e)}fillColumn(e,t){const s=[];for(let t=0;t<this.widthBoard;t++)s.push(this.squares[e+this.widthBoard*t].getValue());const r=s.filter((e=>e)),o=this.widthBoard-r.length;this.makeNewSequence(r,o,t).forEach(((t,s)=>{this.squares[e+this.widthBoard*s].setValue(t)}))}makeNewSequence(e,t,s){const r=Array(t).fill("");return s?e.concat(r):r.concat(e)}combineColumn(){for(let e=15;e>=this.widthBoard;e--)if(this.squares[e].getValue()===this.squares[e-this.widthBoard].getValue()&&""!==this.squares[e].getValue()){const t=parseInt(this.squares[e].getValue())+parseInt(this.squares[e-this.widthBoard].getValue());this.squares[e].setValue(t),this.squares[e-this.widthBoard].setValue(""),this.gameManager.score=this.gameManager.score+t,r.textContent=this.gameManager.score}}movingRow(e){for(let t=0;t<this.widthBoard*this.widthBoard;t++)t%this.widthBoard==0&&this.fillRow(t,"left"===e)}fillRow(e,t){const s=[];for(let t=0;t<this.widthBoard;t++)s.push(this.squares[e+t].getValue());const r=s.filter((e=>e)),o=this.widthBoard-r.length;this.makeNewSequence(r,o,t).forEach(((t,s)=>{this.squares[e+s].setValue(t)}))}combineRow(){for(let e=15;e>0;e--)if(this.squares[e].getValue()===this.squares[e-1].getValue()&&""!==this.squares[e].getValue()&&e%this.widthBoard!=0){const t=parseInt(this.squares[e].getValue())+parseInt(this.squares[e-1].getValue());this.squares[e].setValue(t),this.squares[e-1].setValue(""),this.gameManager.score=this.gameManager.score+t,r.textContent=this.gameManager.score}}}const a=document.querySelector(".best-result"),i=document.querySelector(".restart-button"),n="https://api.kazanina-online.ru/api/point";class h{constructor(e,t,s){this.isGameOver=!1,this.score=0,this.board=null}init(){this.board=new o,this.board.init(),this.board.generateNewCell(),this.board.generateNewCell(),document.addEventListener("keyup",this.clickControl.bind(this)),i.addEventListener("click",this.newGame.bind(this)),this.getData()}checkForGameOver(){let e=0;for(let t of this.board.squares)if(""!==t.value&&e++,2048===t.value)return alert("Вы победили!"),this.isGameOver=!0,!1;return 16!==e||(alert("Игра окончена!"),this.isGameOver=!0,this.fetchApi(this.board.gameManager.score),!1)}fetchApi(e){const t={userName:"Анна",count:e},s={method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json;charset=utf-8"}};fetch(n,s).then((e=>e.json())).then((e=>console.log(e))).catch((e=>console.error(e)))}getData(){fetch(n).then((e=>e.json())).then((e=>{const t=e.reduce(((e,t)=>e.count>t.count?e:t));a.textContent=t.count})).catch((e=>console.error(e)))}newGame(){const e=document.querySelectorAll(".cell"),t=document.querySelector(".score");this.isGameOver=!1,this.score=0;for(let e=0;e<this.board.widthBoard*this.board.widthBoard;e++)this.board.squares[e].setValue("");this.board=null;for(let t=0;t<e.length;t++)16===e.length&&e[t].remove();t.textContent="0",this.init()}clickControl(e){if("ArrowUp"===e.key){if(this.board.movingColumn("up"),this.board.combineColumn(),this.board.movingColumn("up"),!this.checkForGameOver())return;this.board.generateNewCell()}else if("ArrowDown"===e.key){if(this.board.movingColumn(),this.board.combineColumn(),this.board.movingColumn(),!this.checkForGameOver())return;this.board.generateNewCell()}else if("ArrowLeft"===e.key){if(this.board.movingRow("left"),this.board.combineRow(),this.board.movingRow("left"),!this.checkForGameOver())return;this.board.generateNewCell()}else if("ArrowRight"===e.key){if(this.board.movingRow(),this.board.combineRow(),this.board.movingRow(),!this.checkForGameOver())return;this.board.generateNewCell()}}}(new h).init()})();