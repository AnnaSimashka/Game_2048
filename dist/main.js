(()=>{"use strict";const e=["#afa192","#eee4da","#ede0c8","#f2b179","#ffcea4","#e8c064","#ffab6e","#fd9982","#ead79c","#76daff","#beeaa5","#d7d4f0"];class t{constructor(e,t){this.value="",this.dom=null}getValue(){return this.value}setValue(t){this.value=t,this.dom.textContent=t,this.dom.style.backgroundColor=e[Math.trunc(Math.sqrt(t))]}getNewElement(){if(null!==this.dom)throw new Error("Cell уже существует!");const e=document.createElement("div");return e.innerHTML="",e.className="cell",this.dom=e,e}}class s{constructor(e,t,s){this.widthBoard=4,this.squares=[],this.wrapper=document.querySelector(".grid")}init(){const e=document.createDocumentFragment();for(let s=0;s<this.widthBoard*this.widthBoard;s++){const s=new t;e.appendChild(s.getNewElement()),this.squares.push(s)}this.wrapper.appendChild(e)}generateNewCell(){const e=Math.floor(Math.random()*this.squares.length);""===this.squares[e].getValue()?this.squares[e].setValue(2):this.generateNewCell()}movingColumn(e){for(let t=0;t<this.widthBoard;t++)this.fillColumn(t,"up"===e)}fillColumn(e,t){const s=[];for(let t=0;t<this.widthBoard;t++)s.push(this.squares[e+this.widthBoard*t].getValue());const i=s.filter((e=>e)),o=this.widthBoard-i.length;this.makeNewSequence(i,o,t).forEach(((t,s)=>{this.squares[e+this.widthBoard*s].setValue(t)}))}makeNewSequence(e,t,s){const i=Array(t).fill("");return s?e.concat(i):i.concat(e)}combineColumn(){for(let e=15;e>=this.widthBoard;e--)if(this.squares[e].getValue()===this.squares[e-this.widthBoard].getValue()&&""!==this.squares[e].getValue()){const t=parseInt(this.squares[e].getValue())+parseInt(this.squares[e-this.widthBoard].getValue());this.squares[e].setValue(t),this.squares[e-this.widthBoard].setValue("")}}movingRow(e){for(let t=0;t<this.widthBoard*this.widthBoard;t++)t%this.widthBoard==0&&this.fillRow(t,"left"===e)}fillRow(e,t){const s=[];for(let t=0;t<this.widthBoard;t++)s.push(this.squares[e+t].getValue());const i=s.filter((e=>e)),o=this.widthBoard-i.length;this.makeNewSequence(i,o,t).forEach(((t,s)=>{this.squares[e+s].setValue(t)}))}combineRow(){for(let e=15;e>0;e--)if(this.squares[e].getValue()===this.squares[e-1].getValue()&&""!==this.squares[e].getValue()&&e%this.widthBoard!=0){const t=parseInt(this.squares[e].getValue())+parseInt(this.squares[e-1].getValue());this.squares[e].setValue(t),this.squares[e-1].setValue("")}}}document.querySelector(".score"),document.querySelector(".result"),(new class{constructor(e,t,s){this.isGameOver=!1,this.score=0,this.board=null}init(){this.board=new s,this.board.init(),this.board.generateNewCell(),this.board.generateNewCell(),document.addEventListener("keyup",this.clickControl.bind(this))}checkIsGameOver(){console.log("checkIsGameOver")}clickControl(e){"ArrowUp"===e.key?(this.board.movingColumn("up"),this.board.combineColumn(),this.board.movingColumn("up"),this.board.generateNewCell()):"ArrowDown"===e.key?(this.board.movingColumn(),this.board.combineColumn(),this.board.movingColumn(),this.board.generateNewCell()):"ArrowLeft"===e.key?(this.board.movingRow("left"),this.board.combineRow(),this.board.movingRow("left"),this.board.generateNewCell()):"ArrowRight"===e.key&&(this.board.movingRow(),this.board.combineRow(),this.board.movingRow(),this.board.generateNewCell())}}).init()})();